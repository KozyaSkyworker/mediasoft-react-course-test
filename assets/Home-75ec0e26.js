import{G as O,r as d,d as L,a as T,u as m,j as e,L as P,F as z,s as B,b as F,c as M}from"./index-2c66dff3.js";import{C as V,a as G,f as D,P as H}from"./productsSkeleton-a7fe4f00.js";import{u as j,a as U}from"./cartMiddleware-eaba68c5.js";function W(t){return O({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"}}]})(t)}const q="_content_au0zi_1",J="_products_au0zi_6",K="_products__wrapper_au0zi_10",x={content:q,products:J,products__wrapper:K},Q="_product_11ly0_1",X="_product__link_11ly0_14",Y="_product__img_11ly0_18",Z="_product__fakeimg_11ly0_22",tt="_product__img_skeleton_11ly0_29",et="_product__title_11ly0_36",st="_product__bot_11ly0_40",rt="_product__favorites_11ly0_52",ot="_product__favorites_active_11ly0_55",ct="_product__cart_active_11ly0_59",nt="_updown_11ly0_1",u={product:Q,product__link:X,product__img:Y,product__fakeimg:Z,product__img_skeleton:tt,product__title:et,product__bot:st,product__favorites:rt,product__favorites_active:ot,product__cart_active:ct,updown:nt};var N=new Map,y=new WeakMap,I=0,it=void 0;function at(t){return t?(y.has(t)||(I+=1,y.set(t,I.toString())),y.get(t)):"0"}function _t(t){return Object.keys(t).sort().filter(s=>t[s]!==void 0).map(s=>`${s}_${s==="root"?at(t.root):t[s]}`).toString()}function dt(t){let s=_t(t),c=N.get(s);if(!c){const i=new Map;let _;const r=new IntersectionObserver(n=>{n.forEach(o=>{var a;const f=o.isIntersecting&&_.some(h=>o.intersectionRatio>=h);t.trackVisibility&&typeof o.isVisible>"u"&&(o.isVisible=f),(a=i.get(o.target))==null||a.forEach(h=>{h(f,o)})})},t);_=r.thresholds||(Array.isArray(t.threshold)?t.threshold:[t.threshold||0]),c={id:s,observer:r,elements:i},N.set(s,c)}return c}function ut(t,s,c={},i=it){if(typeof window.IntersectionObserver>"u"&&i!==void 0){const a=t.getBoundingClientRect();return s(i,{isIntersecting:i,target:t,intersectionRatio:typeof c.threshold=="number"?c.threshold:0,time:0,boundingClientRect:a,intersectionRect:a,rootBounds:a}),()=>{}}const{id:_,observer:r,elements:n}=dt(c);let o=n.get(t)||[];return n.has(t)||n.set(t,o),o.push(s),r.observe(t),function(){o.splice(o.indexOf(s),1),o.length===0&&(n.delete(t),r.unobserve(t)),n.size===0&&(r.disconnect(),N.delete(_))}}function lt({threshold:t,delay:s,trackVisibility:c,rootMargin:i,root:_,triggerOnce:r,skip:n,initialInView:o,fallbackInView:a,onChange:f}={}){var h;const[g,$]=d.useState(null),k=d.useRef(),[w,R]=d.useState({inView:!!o,entry:void 0});k.current=f,d.useEffect(()=>{if(n||!g)return;let v;return v=ut(g,(E,S)=>{R({inView:E,entry:S}),k.current&&k.current(E,S),S.isIntersecting&&r&&v&&(v(),v=void 0)},{root:_,rootMargin:i,threshold:t,trackVisibility:c,delay:s},a),()=>{v&&v()}},[Array.isArray(t)?t.toString():t,g,_,i,r,n,c,a,s]);const C=(h=w.entry)==null?void 0:h.target,A=d.useRef();!g&&C&&!r&&!n&&A.current!==C&&(A.current=C,R({inView:!!o,entry:void 0}));const l=[$,w.inView,w.entry];return l.ref=l[0],l.inView=l[1],l.entry=l[2],l}const pt=t=>(s,c)=>{console.log("BEFORE FAVORITES TOGGLE PRODUCT: ",c()),c().favorites.favItems.indexOf(t)>=0?s(L(t)):s(T(t)),console.log("AFTER FAVORITES TOGGLE PRODUCT: ",c())},mt=({id:t,title:s,price:c,thumbnail:i})=>{const _=j(),r=m(a=>a.favorites.favItems),{ref:n,inView:o}=lt({threshold:.5,triggerOnce:!0});return e.jsxs("div",{className:u.product,ref:n,children:[e.jsxs(P,{to:`/mediasoft-react-course-test/products/${t}`,className:u.product__link,children:[o?e.jsxs("div",{className:u.product__fakeimg,children:[s," (картинки сломались :) )"]}):e.jsx("div",{className:u.product__img_skeleton}),e.jsx("p",{className:u.product__title,children:s})]}),e.jsxs("div",{className:u.product__bot,children:[e.jsxs("p",{children:[e.jsx("span",{children:c})," $"]}),e.jsxs("button",{onClick:()=>{_(U({id:t,title:s,thumbnail:i,pricePerOne:c,quantity:1}))},children:[" ",e.jsx(z,{})]}),e.jsx("button",{className:`${u.product__favorites} ${r.indexOf(t)>=0?u.product__favorites_active:""}`,onClick:()=>{_(pt(t))},children:e.jsx(W,{})})]})]})},ft=d.memo(mt),ht="_sidebar_1uz44_1",vt="_sidebar__list_1uz44_9",gt="_sidebar__item_1uz44_12",xt="_sidebar__item_active_1uz44_19",b={sidebar:ht,sidebar__list:vt,sidebar__item:gt,sidebar__item_active:xt},yt=()=>e.jsxs(V,{speed:4,width:270,height:300,viewBox:"0 0 270 300",backgroundColor:"#f3f3f3",foregroundColor:"#dedede",children:[e.jsx("rect",{x:"510",y:"232",rx:"3",ry:"3",width:"88",height:"6"}),e.jsx("rect",{x:"112",y:"-11",rx:"0",ry:"0",width:"107",height:"0"}),e.jsx("rect",{x:"546",y:"360",rx:"0",ry:"0",width:"70",height:"30"}),e.jsx("rect",{x:"551",y:"356",rx:"0",ry:"0",width:"70",height:"26"}),e.jsx("rect",{x:"468",y:"199",rx:"8",ry:"8",width:"100",height:"34"}),e.jsx("circle",{cx:"568",cy:"370",r:"57"}),e.jsx("circle",{cx:"753",cy:"513",r:"241"}),e.jsx("rect",{x:"0",y:"0",rx:"10",ry:"10",width:"250",height:"35"})]}),bt=d.memo(function(){const[s,c]=d.useState(["All"]),[i,_]=d.useState(!0),r=j(),n=m(o=>o.filters.currentCategory);return d.useEffect(()=>{G.get("https://630244f2c6dda4f287b6a17b.mockapi.io/products").then(o=>{let a=Array.from(new Set(o.data.map(f=>f.category)));a=[...s,...a],c(a)}).then(()=>_(!1))},[]),e.jsxs("div",{className:b.sidebar,children:[e.jsx("h3",{children:"Категории товаров"}),e.jsx("ul",{className:b.sidebar__list,children:i?[...new Array(3)].map((o,a)=>e.jsx(yt,{},a)):s.map(o=>e.jsx("li",{className:`${b.sidebar__item} ${o===n?b.sidebar__item_active:""}`,onClick:()=>{r(B(o))},children:o},o))})]})}),jt="_sort_grs9m_1",kt="_sort__clickable_grs9m_10",wt="_sort__selected_grs9m_13",Ct="_sort__list_grs9m_16",St="_sort__item_grs9m_26",Nt="_sort__item_active_grs9m_34",Rt="_sort__selected_active_grs9m_38",p={sort:jt,sort__clickable:kt,sort__selected:wt,sort__list:Ct,sort__item:St,sort__item_active:Nt,sort__selected_active:Rt};function At(t){return O({tag:"svg",attr:{viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}},{tag:"path",attr:{d:"M3 9l4 -4l4 4m-4 -4v14"}},{tag:"path",attr:{d:"M21 15l-4 4l-4 -4m4 4v-14"}}]})(t)}const Et=[{name:"По рейтингу",sortBy:"rating",order:"desc"},{name:"По убыванию цены",sortBy:"price",order:"desc"},{name:"По возрастанию цены",sortBy:"price",order:"asc"},{name:"По названию",sortBy:"title",order:"desc"}],It=d.memo(function(){const s=d.useRef(0),[c,i]=d.useState(!1),_=j(),r=m(n=>n.filters.currentSort);return d.useEffect(()=>{const n=o=>{o.composedPath().includes(s.current)||i(!1)};return document.body.addEventListener("click",n),()=>document.body.removeEventListener("click",n)},[c]),e.jsxs("div",{className:p.sort,children:[e.jsxs("div",{className:p.sort__clickable,onClick:()=>{i(!c)},ref:s,children:[e.jsx(At,{}),e.jsx("span",{className:`${p.sort__selected} ${p.sort__selected_active}`,children:r.name})]}),c&&e.jsx("ul",{className:p.sort__list,children:Et.map(n=>e.jsx("li",{className:`${p.sort__item} ${n.name===r.name?p.sort__item_active:""}`,onClick:()=>{_(F(n)),i(!1)},children:e.jsx("span",{children:n.name})},n.name))})]})}),Tt=()=>{const t=j(),s=m(r=>r.filters.currentCategory),c=m(r=>r.filters.currentSort),i=m(r=>r.data.products),_=m(r=>r.data.isLoading);return d.useEffect(()=>{t(M(!0)),t(D(s==="All"?"":s,c))},[s,c]),e.jsxs("div",{className:x.home,children:[e.jsx("h1",{children:"Каталог товаров"}),e.jsxs("div",{className:x.content,children:[e.jsx(bt,{}),e.jsxs("section",{className:x.products,children:[e.jsx(It,{}),e.jsx("div",{className:x.products__wrapper,children:_?[...new Array(3)].map((r,n)=>e.jsx(H,{},n)):i.map(r=>e.jsx(ft,{...r},r.id))})]})]})]})};export{Tt as default};
